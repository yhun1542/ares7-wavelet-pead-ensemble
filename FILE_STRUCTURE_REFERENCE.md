# File Structure Reference - ARES7 Ensemble Project

## ðŸ“ Data Files

### 1. `data/buyback_events.csv` (Buyback Event Table)

**Generated by**: `research/pead/buyback_event_builder_v2.py`

**Columns**:
```
event_date,ticker,amount_usd,signal_rank,bucket,split
```

**Column Details**:
- `event_date` (datetime): Filing date of 8-K buyback announcement (normalized to 00:00:00)
- `ticker` (string): Stock ticker symbol (e.g., AAPL, MSFT)
- `amount_usd` (float): Buyback amount in USD (e.g., 200000000000.0 = $200B)
- `signal_rank` (float): Cross-sectional percentile rank within event_date (0.0-1.0)
- `bucket` (string): Event bucket classification
  - `bb_top`: Top 10% by amount (signal_rank >= 0.9)
  - `neutral`: Others
- `split` (string): Train/Val/Test split
  - `train`: 2016-2019
  - `val`: 2020-2021
  - `test`: 2022-2025

**Sample**:
```
2016-01-26,AAPL,200000000000.0,1.0,bb_top,train
2016-01-28,MSFT,25700000000.0,1.0,bb_top,train
```

**Current Status**: 260 events (10 tickers: AAPL, MSFT, GOOGL, JPM, CVX, JNJ, XOM, BAC, PFE)

---

### 2. `data/prices.csv` (Price Data)

**Source**: Sharadar SF1 / Yahoo Finance

**Columns**:
```
symbol,timestamp,open,high,low,close,volume,vwap
```

**Column Details**:
- `symbol` (string): Stock ticker symbol
- `timestamp` (datetime): Trading date with timezone (05:00:00 = UTC+5)
- `open` (float): Opening price
- `high` (float): Highest price
- `low` (float): Lowest price
- `close` (float): Closing price (used for returns)
- `volume` (float): Trading volume
- `vwap` (float): Volume-weighted average price

**Sample**:
```
AAPL,2015-11-23 05:00:00,29.8175,29.9325,29.335,29.4375,129930112.0,29.5838
AAPL,2015-11-24 05:00:00,29.3325,29.8375,29.28,29.72,171212688.0,29.6536
```

**Coverage**: 100 tickers (SP100), 2015-2025, 2,512 trading days

**Note**: Timestamp has 05:00:00 timezone, must normalize to 00:00:00 for date matching

---

### 3. `data/pead_event_table_positive.csv` (PEAD Event Table)

**Generated by**: `research/pead/create_positive_surprise_events.py`

**Columns**:
```
date,symbol,eps,eps_prev,surprise,surprise_rank
```

**Column Details**:
- `date` (datetime): Earnings announcement date (event date)
- `symbol` (string): Stock ticker symbol
- `eps` (float): Actual EPS reported
- `eps_prev` (float): Previous quarter EPS
- `surprise` (float): EPS surprise (eps - eps_prev)
- `surprise_rank` (float): Cross-sectional percentile rank within date (0.0-1.0)

**Sample**:
```
2016-03-30,ADBE,0.51,0.44,0.07,1.0
2016-04-05,NKE,0.56,0.46,0.10,1.0
```

**Current Status**: 901 events (positive surprise only, top 10%)

---

### 4. `data/ares7_base_weights.csv` (Base Portfolio Weights)

**Generated by**: `research/pead/build_vol_weight_base.py`

**Columns**:
```
date,symbol,weight
```

**Column Details**:
- `date` (datetime): Trading date
- `symbol` (string): Stock ticker symbol
- `weight` (float): Portfolio weight (0.0-1.0)
  - Volatility-weighted (inverse volatility)
  - Sum to 1.0 for each date

**Sample**:
```
2016-01-04,AAPL,0.0102
2016-01-04,MSFT,0.0098
```

**Coverage**: 243,151 records (100 tickers Ã— 2,471 days)

---

### 5. `data/sf1_eps.csv` (Raw EPS Data)

**Source**: Sharadar SF1 Fundamentals

**Columns**:
```
ticker,dimension,datekey,calendardate,reportperiod,eps
```

**Column Details**:
- `ticker` (string): Stock ticker symbol
- `dimension` (string): Data dimension (ARQ = As-Reported Quarterly)
- `datekey` (datetime): Announcement date (filing date)
- `calendardate` (datetime): Calendar quarter end date
- `reportperiod` (datetime): Fiscal quarter end date
- `eps` (float): Earnings per share

**Sample**:
```
AAPL,ARQ,2010-04-21,2010-03-31,2010-03-27,0.121
AAPL,ARQ,2010-07-21,2010-06-30,2010-06-26,0.128
```

**Usage**: Source data for PEAD event table generation

---

## ðŸ”§ Data Processing Notes

### Date Normalization
- **prices.csv**: `timestamp` has 05:00:00 â†’ normalize to 00:00:00
- **buyback_events.csv**: `event_date` already normalized to 00:00:00
- **pead_event_table_positive.csv**: `date` already normalized to 00:00:00

### Matching Logic
```python
# Normalize price dates
px_long['timestamp'] = pd.to_datetime(px_long['timestamp']).dt.normalize()

# Normalize event dates
events['event_date'] = pd.to_datetime(events['event_date']).dt.normalize()

# Now they can be matched
matched = events[events['event_date'].isin(px.index)]
```

### Missing Tickers
- **BAC, PFE**: In buyback_events.csv but not in prices.csv
- **Solution**: Filter events to only include tickers present in prices

---

## ðŸ“Š Data Statistics

| File | Records | Tickers | Date Range | Size |
|------|---------|---------|------------|------|
| prices.csv | 251,200 | 100 | 2015-2025 | ~50MB |
| buyback_events.csv | 260 | 9 | 2016-2024 | 40KB |
| pead_event_table_positive.csv | 901 | 100 | 2016-2025 | ~50KB |
| ares7_base_weights.csv | 243,151 | 100 | 2016-2025 | ~8MB |
| sf1_eps.csv | ~50,000 | 100 | 2010-2025 | ~5MB |

---

## ðŸŽ¯ Usage Examples

### Load Buyback Events
```python
import pandas as pd

events = pd.read_csv('data/buyback_events.csv', parse_dates=['event_date'])
bb_top = events[events['bucket'] == 'bb_top']
print(f"Total bb_top events: {len(bb_top)}")
```

### Load Prices
```python
px_long = pd.read_csv('data/prices.csv')
px_long['timestamp'] = pd.to_datetime(px_long['timestamp']).dt.normalize()
px = px_long.pivot(index='timestamp', columns='symbol', values='close')
px = px.ffill().fillna(0)
```

### Load PEAD Events
```python
pead = pd.read_csv('data/pead_event_table_positive.csv', parse_dates=['date'])
print(f"Total PEAD events: {len(pead)}")
```

### Load Base Weights
```python
w_base_long = pd.read_csv('data/ares7_base_weights.csv', parse_dates=['date'])
w_base = w_base_long.pivot(index='date', columns='symbol', values='weight')
w_base = w_base.fillna(0.0)
```

---

**Last Updated**: Dec 01, 2024 07:40 UTC
